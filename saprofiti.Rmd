---
title: "Statistička analiza podataka - Projekt Analiza čimbenika rizika za srčane bolesti"
author: "Saprofiti"
date: "`r Sys.Date()`"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r}
library(dplyr)
library(ggplot2)
library(magrittr)
library(tidyr)
library(readr)
```


## R Markdown

This is an R Markdown document. Markdown is a simple formatting syntax for authoring HTML, PDF, and MS Word documents. For more details on using R Markdown see <http://rmarkdown.rstudio.com>.

When you click the **Knit** button a document will be generated that includes both content as well as the output of any embedded R code chunks within the document. You can embed an R code chunk like this:

Note that the `echo = FALSE` parameter was added to the code chunk to prevent printing of the R code that generated the plot.

# Učitavanje podataka

```{r}
data <- read_csv("heart.csv")
```


### DESKRIPTIVNA STATISTIKA i VIZUALIZACIJA


# Prikaz prvih 6 redova

```{r}
head(data)
```
# Opis značajki

AGE -> Age of the patient [years]
Sex -> Sex of the patient [M: Male, F: Female]
ChestPainType -> chest pain type [TA: Typical Angina, ATA: Atypical Angina, NAP: Non-Anginal Pain, ASY: Asymptomatic]
RestingBP -> Resting blood pressure [mm Hg]
Cholesterol -> Serum cholesterol [mm/dl]
FastingBS -> Fasting blood sugar [1: if Fasting blood sugar > 120 mg/dl, 0: otherwise]
RestingECG -> Resting electrocardiogram results [Normal: Normal, ST: having ST-T wave abnormality (T wave inversions and/or ST elevation or depression of > 0.05 mV), LVH: showing probable or definite left ventricular hypertrophy by Estes’ criteria]
MaxHR -> Maximum heart rate achieved [Numeric value between 60 and 202]
ExerciseAngina -> Exercise-induced angina [Y: Yes, N: No]
Oldpeak -> Exercise-induced ST depression [ST depression induced by exercise relative to rest]
ST_Slope -> Slope of the peak exercise ST segment [Up: upsloping, Flat: flat, Down: downsloping]
HeartDisease -> Output class [1: heart disease, 0: Normal]


# Opis podataka
```{r}
dim(data)  # broj redaka, broj stupaca (broj primjera, broj varijabli) 
cat("Number of rows: ", nrow(data), "\n")
cat("Number of columns: ", ncol(data), "\n")
cat("Column names:", paste(colnames(data), collapse = ", "), "\n")
```
# Čišćenje podataka


# Monotone i konstantne vrijednosti
```{r}
cat("Number of rows is ", nrow(data), "\n")
for (column in colnames(data)){
  cat("Column: ", column, "has ", length(unique(data[[column]])), " unique values\n")
}
```
Pošto je broj jedinstvenih vrijednosti za svaku značajku manji od broja redaka, možemo zaključiti da nema monotone vrijednosti (napomena: provjerili smo i ručno kako se ne bi dogodilo da zbog nedostajućih vrijednosti izgleda kao da nema monotonih vrijednosti).
Također, vidimo da nema ni konstantnih vrijednosti jer je broj jedinstvenih vrijednosti za svaku značajku veći od 1.


# Nedostajuće vrijednosti
```{r}
data %>% is.na() %>% colSums()
```
Nema nedostajućih vrijednosti, pa preskačemo korak zamjene nedostajućih vrijednosti


# Transformiranje kategoričkih značajki u numeričke
Mogli smo koristiti i one-hot encoding za neke značajke, no smatramo da ipak između svih značajki postoji neko uređenje te smo se zato odlučili za label encoding (npr. za značajku ChestPainType može biti TA -> ATA -> NAP -> ASY gdje određeni simptomi postaju manje karakteristični za anginu; ST_Slope također ima uređenje up -> flat -> down)



```{r}
cat(unique(data$Sex), "\n")
oldCategoricalData <- data
data$Sex <- as.numeric(factor(data$Sex, levels = c("F", "M"), labels = c(0, 1))) - 1
data$ExerciseAngina <- as.numeric(factor(data$ExerciseAngina, levels = c("N", "Y"), labels = c(0, 1))) - 1
data$ChestPainType <- as.numeric(factor(data$ChestPainType, levels = c("TA", "ATA", "NAP", "ASY"), labels = c(0, 1, 2, 3)))
data$RestingECG <- as.numeric(factor(data$RestingECG, levels = c("Normal", "ST", "LVH"), labels = c(0, 1, 2)))
data$ST_Slope <- as.numeric(factor(data$ST_Slope, levels = c("Up", "Flat", "Down"), labels = c(0, 1, 2)))
```




# Nastavak deskriptivne statistike
Sada kad smo očistili podatke, možemo nastaviti s deskriptivnom statistikom.
Prvo ćemo izvući osnovne statistike za podatke kao što su minimum, maksimum, kvantili i srednja vrijednost za numeričke podatke i učestalost pojavljivanja po kategorijama za kategoričke. 

```{r}
data[-c(2,3,6,7,9,11,12)] %>% summary()
```




```{r}
# učestalost pojavljivanja vrijednosti za kategoričke značajke
for (column in c(2, 3, 6, 7, 9, 11, 12)) {
  column_name <- colnames(oldCategoricalData)[column]
  column_values <- oldCategoricalData[[column]]
  cat("Column:", column_name, "has values:\n")
  print(table(column_values))
  cat("\n")
}
```
# Račun mjera centralne tendencije i rasipanja numeričkih podataka u raznim kombinacijama

## Analiza podataka ovisno o spolu

```{r}
library(tidyverse)

data %>% group_by(Sex) %>% summarise(
  NumOfPatients = n(),
  HeartDiseaseRatio = sum(HeartDisease)/n(),
  FastingBSRatio = sum(FastingBS)/n(),
  ExerciseAnginaRatio = sum(ExerciseAngina)/n(),
  Mean.Age = mean(Age),
  Med.Age = median(Age),
  Mean.RestingBP = mean(RestingBP),
  Med.RestingBP = median(RestingBP),
  StdDev.RestingBP = sd(RestingBP),
  Mean.Cholesterol = mean(Cholesterol),
  StdDev.Cholesterol = sd(Cholesterol),
  Med.Cholesterol = median(Cholesterol),
  Mean.MaxHR = mean(MaxHR),
  StdDev.MaxHR = sd(MaxHR),
  Med.MaxHR = median(MaxHR),
  Mean.OldPeak = mean(Oldpeak),
  StdDev.OldPeak = sd(Oldpeak),
  Med.OldPeak = median(Oldpeak)
) 
```
Na prvu uočavamo razlike između srednjih vrijednosti (a i medijana) najvećeg broja otkucaja srca (MaxHR) i količine kolesterola (Cholesterol), razliku u udjelu onih s visokim šećerom i vježbom induciranom anginom u muškaraca i žena, te, možda najvažnije, razliku u udjelu srčanih bolesnika među muškarcima i ženama.
To bi moglo motivirati pitanja o utjecaju spola na vrijednosti tih parametara.

Možemo prvo analizirati boxplotovima.

```{r}
boxplot(Cholesterol ~ Sex, data = data)
```
```{r}
boxplot(MaxHR ~ Sex, data = data)
```

## Analiza podataka s obzirom na dob

```{r}
library(tidyverse)

helperData <- data
dataWithAgeCategory <- helperData %>% mutate(ageCategory = cut(data$Age,
                      breaks = c(0, 30, 50, 70, 90, 120),  # Define the break points
                      labels = c("Category-1", "Category-2", "Category-3", "Category-4", "Category-5"), 
                      right = TRUE))


dataWithAgeCategory %>% group_by(ageCategory) %>% summarise(
  NumOfPatients = n(),
  HeartDiseaseRatio = sum(HeartDisease)/n(),
  FastingBSRatio = sum(FastingBS)/n(),
  ExerciseAnginaRatio = sum(ExerciseAngina)/n(),
  Mean.Age = mean(Age),
  Med.Age = median(Age),
  Mean.RestingBP = mean(RestingBP),
  Med.RestingBP = median(RestingBP),
  StdDev.RestingBP = sd(RestingBP),
  Mean.Cholesterol = mean(Cholesterol),
  StdDev.Cholesterol = sd(Cholesterol),
  Med.Cholesterol = median(Cholesterol),
  Mean.MaxHR = mean(MaxHR),
  StdDev.MaxHR = sd(MaxHR),
  Med.MaxHR = median(MaxHR),
  Mean.OldPeak = mean(Oldpeak),
  StdDev.OldPeak = sd(Oldpeak),
  Med.OldPeak = median(Oldpeak)
)
```
Ovdje uočavamo kako udio srčanih bolesnika, bolesnika s anginom i bolesnika s visokim šećerom raste svakom dobnom kategorijom, kao i vrijednosti OldPeak, dok MaxHR i Cholesterol padaju. To bi moglo potaknuti pitanja o ovisnosti dobi i vrijednosti tih parametara.

```{r}
{plot(data$Age, data$Cholesterol,
     col="blue",
     xlab='Age',
     ylab='Cholesterol Level')
  abline(lm(data$Cholesterol ~ data$Age), col="red")}
```
Iz ovog scatterplota vidimo gotovo nepostojeću korelaciju između dobi i razine kolesterola.

```{r}
lowCholesterolCnt = nrow(data[data$Cholesterol < 120,])
lowCholesterolCnt
```

```{r}
x <- data$Age
y <- data$MaxHR

model = lm(y ~ x)
{plot(x, y,
     col="blue",
     xlab='Age',
     ylab='MaxHR')
abline(model, col = "red")}
```
Ovaj scatterplot ukazuje na slabu negativnu korelaciju između vrijednosti parametara MaxHR i Age.

```{r}
{plot(data$Age, data$Oldpeak,
     col="blue",
     xlab='Age',
     ylab='OldPeak')

abline(lm(data$Oldpeak ~ data$Age), col = "red")}
```
Grafovi ukazuju na to da nam se najviše isplati postaviti pitanje o ovisnosti MaxHR o dobi (iako je ta korelacija također dosta blaga), jer ostale ovisnosti iz grafova izgledaju još više nekorelirano.


## Analiza ovisno o prisutnosti srčane bolesti

```{r}
library(tidyverse)

data %>% group_by(HeartDisease) %>% summarise(
  NumOfPatients = n(),
  FastingBSRatio = sum(FastingBS)/n(),
  ExerciseAnginaRatio = sum(ExerciseAngina)/n(),
  Mean.Age = mean(Age),
  Med.Age = median(Age),
  Mean.RestingBP = mean(RestingBP),
  Med.RestingBP = median(RestingBP),
  StdDev.RestingBP = sd(RestingBP),
  Mean.Cholesterol = mean(Cholesterol),
  StdDev.Cholesterol = sd(Cholesterol),
  Med.Cholesterol = median(Cholesterol),
  Mean.MaxHR = mean(MaxHR),
  StdDev.MaxHR = sd(MaxHR),
  Med.MaxHR = median(MaxHR),
  Mean.OldPeak = mean(Oldpeak),
  StdDev.OldPeak = sd(Oldpeak),
  Med.OldPeak = median(Oldpeak)
)
```
Ovdje konkretno vidimo izračunate mjere srednjih vrijednosti parametara za srčane bolesnike i one koji to nisu. Vidimo da se vrijednosti parametara Cholesterol, MaxHR i OldPeak razlikuju po grupama, kao i udio onih s povišenim šećerom i onih s vježbom induciranom anginom. To bi moglo motivirati pitanja može li se na temelju vrijednosti takvih parametara predvidjeti postojanje srčane bolesti.

Najbolje je to prvo analizirati boxplot dijagramima, paralelno za srčane bolesnike i zdrave pacijente.

```{r}
boxplot(Cholesterol ~ HeartDisease, data = data)
```
Na ovom boxplotu vidimo kako se količine kolesterola više rasipaju u bolesnika te je njihova distribucija desno zakrivljena, ali u pacijenata koji nisu srčani bolesnici ima mnogo stršećih vrijednosti pa je dobro promatrati medijane umjesto srednjih vrijednosti za ovaj primjer.

```{r}
boxplot(MaxHR ~ HeartDisease, data = data)
```
Ovaj bi boxplot mogao sugerirati na razliku u vrijednosti MaxHR parametra ovisno o tome je li pacijent srčani bolesnik ili ne - vidimo da za srčane bolesnike vrijedi da su vrijednosti MaxHR-a niže te da medijan bude manji te čak izvan vrijednosti prvog kvartila u skupini srčanih nebolesnika.

```{r}
boxplot(Oldpeak ~ HeartDisease, data = data)
```
Slično prošlom primjeri, ovaj boxplot mogao sugerirati na razliku u vrijednosti Oldpeak parametra ovisno o tome je li pacijent srčani bolesnik ili ne - vidimo da za srčane bolesnike vrijedi da su vrijednosti Oldpeaka-a više te da medijan bude veći te čak izvan vrijednosti trećeg kvartila u skupini srčanih nebolesnika. Slično kao za kolesterol, za srčane bolesnike se vrijednost Oldpeaka manje rasipa (bude konzistentnija), ali ponovno imamo mnogo stršećih (atipičnih vrijednosti), zato je dobro promatrati medijane umjesto srednjih vrijednosti za ovaj primjer.

```{r}
boxplot(Age ~ HeartDisease, data = data)
```
Ponovno, ovaj boxplot mogao bi sugerirati razliku u dobi pacijenata srčanih bolesnika i nebolesnika - vidimo da za srčane bolesnike vrijedi da su veće dobi te da medijan bude veći te čak izvan vrijednosti trećeg kvartila u skupini srčanih nebolesnika. 

```{r}
diseased <- data[data$HeartDisease == 1, ]
healthy <- data[data$HeartDisease == 0, ]

```
```{r}

hist(diseased$MaxHR)
```
```{r}
hist(healthy$MaxHR)
```

## Analiza ovisno o razini šećera

```{r}
library(tidyverse)

data %>% group_by(FastingBS) %>% summarise(
  NumOfPatients = n(),
  HeartDiseaseRatio = sum(HeartDisease)/n(),
  Mean.Age = mean(Age),
  Med.Age = median(Age),
  Mean.RestingBP = mean(RestingBP),
  Med.RestingBP = median(RestingBP),
  StdDev.RestingBP = sd(RestingBP),
  Mean.Cholesterol = mean(Cholesterol),
  StdDev.Cholesterol = sd(Cholesterol),
  Med.Cholesterol = median(Cholesterol),
  Mean.MaxHR = mean(MaxHR),
  StdDev.MaxHR = sd(MaxHR),
  Med.MaxHR = median(MaxHR),
  Mean.OldPeak = mean(Oldpeak),
  StdDev.OldPeak = sd(Oldpeak),
  Med.OldPeak = median(Oldpeak)
)
```



# Normalizacija numeričkih značajki
```{r}
unNormalizedData <- data
data[-c(2,3,6,7,9,11,12)] <- scale(data[-c(2,3,6,7,9,11,12)])
```


### ISTRAŽIVAČKA PITANJA
VAŽNA NAPOMENA: Alfa vrijednost određuje se prije provođenja statističkog testa; mi ćemo u svim testovima uzeti da je alfa = 0.05 odnosno 5%.

## 1. pitanje
# Postoji li razlika u maksimalnom broju otkucaja srca između pacijenata s anginom i onih bez angine?
Kako bismo odgovorili na ovo pitanje trebamo koristiti T-test za dva uzorka.
Znamo da T-test ima neke osnovne pretpostavke koje moramo provjeriti, a moramo provjeriti i jesu li varijance podataka jednake ili različite.
Prvo ćemo pogledati jesu li podatci uzorkovani iz normalne razdiobe, a nakon toga provesti F-test kako bismo utvrdili jesu li varijance jednake ili različite.

```{r}
withAngine <- data[data$ExerciseAngina == 1,]
withoutAngine <- data[data$ExerciseAngina == 0,]
maxHRWithAngine <- withAngine$MaxHR
maxHRWithoutAngine <- withoutAngine$MaxHR

# crtamo Q-Q plot kako bismo vidjeli odgovaraju li podatci normalnoj raspodjeli
qqnorm(maxHRWithAngine, main = "Q-Q plot for MaxHR with angine")
qqline(maxHRWithAngine)

qqnorm(maxHRWithoutAngine , main = "Q-Q plot for MaxHR without angine")
qqline(maxHRWithoutAngine)


# isto radimo s histogramima
hist(maxHRWithAngine, main = "Histogram for MaxHR with angine")

hist(maxHRWithoutAngine, main = "Histogram for MaxHR without angine")
```


Iz grafova možemo zaključiti da se za osobe s anginom značajka MaxHR ravna po normalnoj razdiobi, dok se za osobe bez angine sredina ravna po normalnoj raspodjeli, no repovi su različiti od normalne raspodjele.
Dodatno, histogram za osobe bez angine pokazuje da su podatci malo pomaknuti od sredine 0. Možemo provesti Lillieforsov test kako bi provjerili odgovaraju li podatci normalnoj razdiobi. 
Ipak, T razdioba robusna je na normalnost podataka, pa možemo nastaviti s testiranjem razlike u srednjim vrijednostima.
Pretpostavku nezavisnosti podataka temeljimo na činjenici da su podatci preuzeti iz različitih skupina odnosno od različitih ljudi.

```{r}
library(nortest)
lillie.test(maxHRWithoutAngine)
lillie.test(maxHRWithAngine)
```
Nastavljamo s F-testom kako bismo utvrdili jesu li varijance obaju skupova podataka jednake ili različite.

```{r}
var(maxHRWithoutAngine)
var(maxHRWithAngine)
var.test(maxHRWithAngine, maxHRWithoutAngine)
```
Vidimo kako je p-vrijednost značajno manja od alfa = 5% pa zaključujemo da su varijance različite; radi toga koristimo T-test za dva uzorka s različitim varijancama.

```{r}
t.test(maxHRWithAngine, maxHRWithoutAngine, var.equal = FALSE)
```
Iz rezultata vidimo kako je p-vrijednost značajno manja od alfa = 5% pa zaključujemo da postoji razlika u maksimalnom broju otkucaja srca između pacijenata s anginom i onih bez angine


## 2. pitanje
# Postoji li značajna razlika u starosti pacijenata s obzirom na različite vrste boli u prsima?


## 3. pitanje
# Možemo li predvidjeti prisutnost srčane bolesti na temelju maksimalnog broja otkucaja srca i starosti?

Za pronalazak odgovora na treće pitanje koristimo logističku regresiju. Linearna regresija nije dobar izbor jer je problem klasifikacijski.
Linearna regresija loše klasificira jer funkcija pogreške kažnjava i točno klasificirane primjere koji su daleko od granice odluke te zbog toga stršeće vrijednosti mogu značajno utjecati na pomak granice odluke (čak i kada su točno klasificirane).

Za logističku regresiju trebamo provjeriti nekoliko pretpostavki:
1. Ne smije biti multikolinearnosti u podatcima
2. Podatci moraju biti nezavisni (ulazi su nezavisne varijable dok je izlaz y zavisna varijabla)
3. Nema nedostajućih vrijednosti i klase imaju balansirani broj primjera (u našem slučaju oba uvjeta su ispunjena, provjera je napravljena u fazi čišćenja podataka)

Prije provedbe logističke regresije poželjno je vizualizirati podatke kako bismo dobili bolji uvid u njih. U našem slučaju možemo koristiti graf raspršenja jer imamo samo dvije varijable.

```{r}
colors <- ifelse(oldCategoricalData$HeartDisease == 1, rgb(1,0,0,0.5), rgb(0,0,1,0.5)) 
plot(oldCategoricalData$Age, oldCategoricalData$MaxHR, col = colors, main = "Scatter plot for Age and MaxHR", xlab = "Age", ylab = "MaxHR", pch = 19)
legend("topright", legend = c("Heart Disease", "No Heart Disease"), fill = c("red", "blue"))
```
Iz grafa je vidljivo kako su srčane bolesti rjeđe kod mlađih ljudi koji imaju veći maksimalan broj otkucaja srca, dok stariji ljudi s manjim maksimalnim brojem otkucaja srca češće imaju srčane bolesti.

# Provjera pretpostavki logističke regresije
Funkcijom cor tražimo korelaciju između naših dviju varijabli.

```{r}
library(ggcorrplot)

predictor <- data.frame(data$Age, data$MaxHR)
cor(predictor)
#ggcorrplot(cor(predictor), hc.order = TRUE, type = "lower", lab = TRUE)
```
Dobili smo korelaciju od -0.38 što je relativno slaba korelacija, pa možemo nastaviti s provođenjem logističke regresije.


```{r}
logisticModel <- glm(HeartDisease ~ MaxHR + Age, data = data, family = binomial)
summary(logisticModel)
```
Nakon što smo proveli logističku regresiju možemo analizirati dobivene rezultate.

Vidimo kako je koeficijent MaxHR jednak -0.83 što sugerira da se s povećanjem maksimalnog broja otkucaja srca smanjuje vjerojatnost imanja srčane bolesti.
Koeficijent uz Age je 0.3566 što sugerira da starije osobe s većom vjerojatnošću imaju srčanu bolest.
Dobiveni rezultati slažu se s vizualizacijom podataka koju smo napravili ranije.

P-vrijednosti su male: 2 * 10^-16 za MaxHR i 8.55 * 10^-6 za Age, iz čega možemo zaključiti kako oba koeficijenta imaju statistički značajan utjecaj.


# Predikcija

```{r}
library(pROC)
# Predikcije
predictions <- predict(logisticModel, type = "response")
# ROC krivulja
roc_curve <- roc(data$HeartDisease, predictions)
plot(roc_curve, main = "ROC Curve")
# AUC vrijednost
auc(roc_curve)
```
Tzv. "area under the curve" predstavlja površinu ispod ROC krivulje. Znamo kako je ROC krivulja jednostavno pravac pod kutem od 45 stupnjeva ako je predikcija potpuno slučajna. Što je veća površina ispod grafa, bolja je sposobnost predikcije. Idealno je AUC jednak 1.

Za naš slučaj AUC je 0.7467, iz čega zaključujemo kako naš model ima dobru sposobnost predikcije. Poboljšanje rezultata eventualno bismo mogli postići tako da bismo u predikciju dodali još relevatnih značajki.



## 4. pitanje
# Postoji li razlika u razini kolesterola između muškaraca i žena?

Kao i u prvom istraživačkom pitanju koristimo T-test za dva uzorka.
Opet ćemo prvo provjeriti normalnost podataka i nakon toga varijanci pomoću F-testa.
Opet pretpostavljamo nezavisnost podataka jer su podatci uzeti iz različitih skupina.

```{r}
# crtamo Q-Q plot da vidimo odgovaraju li podatci normalnoj raspodjeli
male <- data[data$Sex == 1,]
female <- data[data$Sex == 0,]

maxHRMale <- male$MaxHR
maxHRFemale <- female$MaxHR

qqnorm(maxHRMale, main = "Q-Q plot for males")
qqline(maxHRMale)

qqnorm(maxHRFemale , main = "Q-Q plot for females")
qqline(maxHRFemale)

# histogrami

hist(maxHRMale, main = "Histogram for males")

hist(maxHRFemale, main = "Histogram for females")
```
Vidimo kako se podatci ne ravnaju savršeno po normalnoj razdiobi na repovima ali sličnost je dovoljno velika da bi mogli nastaviti s provođenjem testa (mala odstupanja od normalne razdiobe neće utjecati na rezultate zato što je T-test robusan na normalnost podataka).

Nakon što smo utvrdili nezavisnost i normalnost podataka, provodimo F-test kako bismo utvrdili jesu li varijance jednake ili različite.

```{r}
var(maxHRMale)
var(maxHRFemale)

var.test(maxHRMale, maxHRFemale)
```
Opet vidimo kako je p-vrijednost manja od alfa = 5% pa zaključujemo da su varijance različite. Sada znamo da trebamo koristiti T-test za dva uzorka s različitim varijancama.

```{r}
t.test(maxHRMale, maxHRFemale, var.equal = FALSE)
```
Iz rezultata vidimo kako je p-vrijednost značajno manja od alfa = 5% pa zaključujemo da postoji razlika u maksimalnom broju otkucaja srca između muškaraca i žena.


## 5. pitanje
# Postoji li korelacija ili homogenost između spola i kategorijskih čimbenika?

```{r}
data_copy = data.frame(data);
tracemem(data)==tracemem(data_copy);
untracemem(data_copy);
```
```{r}
tbl_angina = table(data_copy$Sex)
print(tbl_angina)
```
```{r}
tbl_angina = table(data_copy$Sex, 
            data_copy$ExerciseAngina)
tbl_angina
```
```{r}
added_margins_tbl_angina = addmargins(tbl_angina)
print(added_margins_tbl_angina)
```
```{r}
for (col_names in colnames(added_margins_tbl_angina)){
  for (row_names in rownames(added_margins_tbl_angina)){
    if (!(row_names == 'Sum' | col_names == 'Sum') ){
      cat('Očekivane frekvencije za razred ',col_names,'-',row_names,': ',(added_margins_tbl_angina[row_names,'Sum'] * added_margins_tbl_angina['Sum',col_names]) / added_margins_tbl_angina['Sum','Sum'],'\n')
    }
  }
}
```
```{r}
chisq.test(tbl_angina, correct=F)
```
Vidimo da je p vrijednost jako mala što znači da odbacujemo hipotezu H0 u korist hipoteze H1 koja glasi da postoji zavisnost između podataka. Tj. da pojava angine izazvane vježbanjem ovisi o spolu.

```{r}
data_copy = data.frame(data);
tracemem(data)==tracemem(data_copy);
untracemem(data_copy);

```
```{r}
tbl_heart_disease = table(data_copy$Sex)
print(tbl_heart_disease)
```
```{r}
tbl_heart_disease = table(data_copy$Sex, 
            data_copy$HeartDisease)
tbl_heart_disease
```
```{r}
added_margins_tbl_heart_disease = addmargins(tbl_heart_disease)
print(added_margins_tbl_heart_disease)
```
```{r}
for (col_names in colnames(added_margins_tbl_heart_disease)){
  for (row_names in rownames(added_margins_tbl_heart_disease)){
    if (!(row_names == 'Sum' | col_names == 'Sum') ){
      cat('Očekivane frekvencije za razred ',col_names,'-',row_names,': ',(added_margins_tbl_heart_disease[row_names,'Sum'] * added_margins_tbl_heart_disease['Sum',col_names]) / added_margins_tbl_heart_disease['Sum','Sum'],'\n')
    }
  }
}
```
```{r}
chisq.test(tbl_heart_disease, correct=F)
```
Vidimo da je p-vrijednost jako mala što znači da odbacujemo hipotezu H0 u korist H1 koja tvrdi da postoji zavisnost između pojave srčanih bolesti i spola.

```{r}
data_copy = data.frame(data);
tracemem(data)==tracemem(data_copy);
untracemem(data_copy);
```
```{r}
tbl_pain_type = table(data_copy$Sex)
print(tbl_pain_type)
```
```{r}
tbl_pain_type = table(data_copy$Sex, 
            data_copy$ChestPainType)
tbl_pain_type
```
```{r}
added_margins_tbl_pain_type = addmargins(tbl_pain_type)
print(added_margins_tbl_pain_type)
```
```{r}
for (col_names in colnames(added_margins_tbl_pain_type)){
  for (row_names in rownames(added_margins_tbl_pain_type)){
    if (!(row_names == 'Sum' | col_names == 'Sum') ){
      cat('Očekivane frekvencije za razred ',col_names,'-',row_names,': ',(added_margins_tbl_pain_type[row_names,'Sum'] * added_margins_tbl_pain_type['Sum',col_names]) / added_margins_tbl_pain_type['Sum','Sum'],'\n')
    }
  }
}
```
```{r}
chisq.test(tbl_pain_type, correct=F)
```
Ponovno vidimo da je p vrijednost jako mala što znači da odbijamo hipotezu H0 u korist H1 koja tvrdi da postoji povezanost između tipa boli i spola.